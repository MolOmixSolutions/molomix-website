<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MolOmix | Unlocking Life's Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/PDBLoader.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at 60% 10%, #14164e 0%, #0a0a2a 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }
        .space-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0;
            pointer-events: none;
        }
        .molomix-title-navbar {
            font-size: 2.6rem;
            font-weight: 900;
            color: #00f5ff;
            letter-spacing: 0.14em;
            text-shadow: 0 0 22px #00f5ff80, 0 2px 8px #000;
            line-height: 1.1;
            font-family: inherit;
            white-space: nowrap;
            margin-left: 0.3em;
            margin-right: 1em;
        }
        .logo-big {
            height: 68px !important;
            width: 68px !important;
        }
        .navbar-brand {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        .navbar-links {
            display: flex;
            align-items: center;
            gap: 1.2rem;
            flex-wrap: nowrap;
        }
        .navbar-links a {
            white-space: nowrap;
        }
        .nav-contact-btn {
            padding-left: 1.15rem;
            padding-right: 1.15rem;
            font-size: 1rem;
            min-width: 120px;
        }
        @media (max-width: 950px) {
            .navbar-links {
                gap: 0.7rem;
            }
            .nav-contact-btn {
                min-width: 100px;
                padding-left: 0.8rem;
                padding-right: 0.8rem;
                font-size: 0.96rem;
            }
            .molomix-title-navbar { font-size: 1.6rem; }
            .logo-big { height: 46px !important; width: 46px !important; }
        }
        @media (max-width: 700px) {
            .molomix-title-navbar { font-size: 1.08rem; margin-left: 0.2em; margin-right: 0.5em; }
            .logo-big { height: 28px !important; width: 28px !important; }
            .navbar-links {
                gap: 0.4rem;
            }
            .nav-contact-btn { min-width: 80px; font-size: 0.89rem; padding: 0.5rem 0.5rem; }
        }
        .motto-below {
            margin-top: 1.5rem;
            font-size: 1.35rem;
            background: rgba(18,22,53,0.85);
            border-radius: 1rem;
            padding: 0.75em 2em;
            color: #e0f7fa;
            box-shadow: 0 2px 30px 0 #00f5ff33;
            text-shadow: 0 0 15px #00f5ff33;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }
        .motto-below .word {
            display: inline-block;
            position: relative;
            opacity: 0;
            transform: translateY(16px) scale(0.95);
            animation: fadeUpMotto 0.8s cubic-bezier(.7,-0.02,.37,1.01) forwards;
        }
        .motto-below .word:nth-child(1)  { animation-delay: 0.1s; }
        .motto-below .word:nth-child(2)  { animation-delay: 0.19s; }
        .motto-below .word:nth-child(3)  { animation-delay: 0.28s; }
        .motto-below .word:nth-child(4)  { animation-delay: 0.37s; }
        .motto-below .word:nth-child(5)  { animation-delay: 0.46s; }
        .motto-below .word:nth-child(6)  { animation-delay: 0.55s; }
        .motto-below .word:nth-child(7)  { animation-delay: 0.64s; }
        .motto-below .word:nth-child(8)  { animation-delay: 0.73s; }
        .motto-below .word:nth-child(9)  { animation-delay: 0.82s; }
        .motto-below .word:nth-child(10) { animation-delay: 0.91s; }
        .motto-below .word:nth-child(11) { animation-delay: 1.0s; }
        @keyframes fadeUpMotto {
            from { opacity: 0; transform: translateY(16px) scale(0.95);}
            60%  { opacity: 1; transform: translateY(-4px) scale(1.03);}
            to   { opacity: 1; transform: translateY(0) scale(1);}
        }
        .motto-underline {
            position: absolute;
            left: 10%;
            right: 10%;
            bottom: 9px;
            height: 3px;
            background: linear-gradient(90deg, #00f5ff 0%, #ffb900 60%, #00f5ff 100%);
            border-radius: 6px;
            animation: underline-move 2.4s cubic-bezier(.7,-0.02,.37,1.01) 1s forwards;
            opacity: 0.42;
            z-index: 1;
        }
        @keyframes underline-move {
            0% { width: 0; opacity: 0;}
            60% { opacity: 0.32; }
            100% { width: 80%; opacity: 0.42;}
        }
        #hero-canvas-container {
            position: relative;
            width: 95vw;
            max-width: 680px;
            margin: 0 auto;
            height: 420px;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #protein-canvas-box {
            background: rgba(12,24,54,0.32);
            border-radius: 1.5rem;
            box-shadow: 0 4px 64px 12px #020c3b44;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            transition: box-shadow 0.3s;
        }
        #protein-canvas {
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            background: transparent;
            display: block;
        }
        .service-icon-anim {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            display: block;
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <canvas id="space-bg" class="space-bg"></canvas>
    <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-opacity-90" style="background:rgba(11,21,44,0.91);backdrop-filter:blur(12px);">
        <nav class="container mx-auto px-3 py-2 flex items-center justify-between min-h-0" style="min-height:unset">
            <div class="navbar-brand">
                <img src="Logo.png" alt="MolOmix Logo" class="logo-big" id="molomix-logo">
                <span class="molomix-title-navbar">MolOmix</span>
            </div>
            <div class="navbar-links">
                <a href="#about" class="nav-link text-gray-300 hover:text-white">About</a>
                <a href="#services" class="nav-link text-gray-300 hover:text-white">Services</a>
                <a href="#contact" class="bg-cyan-400 text-gray-900 font-bold py-2 nav-contact-btn rounded-full hover:bg-cyan-300 transition-all duration-300 btn-glow">Contact Us</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-indigo-900 bg-opacity-90">
            <a href="#about" class="block text-center py-2 px-4 text-sm text-gray-200 hover:bg-indigo-800">About</a>
            <a href="#services" class="block text-center py-2 px-4 text-sm text-gray-200 hover:bg-indigo-800">Services</a>
            <a href="#contact" class="block text-center py-4 px-4 text-sm text-gray-200"><span class="bg-cyan-400 text-gray-900 font-bold py-2 px-5 rounded-full hover:bg-cyan-300">Contact Us</span></a>
        </div>
    </header>

    <main>
        <section id="hero" class="relative min-h-[610px] w-full flex flex-col items-center justify-start text-center overflow-hidden pt-36 pb-2">
            <div id="hero-canvas-container">
                <div id="protein-canvas-box" tabindex="0">
                    <canvas id="protein-canvas"></canvas>
                </div>
            </div>
            <div class="motto-wrap">
                <span class="motto-below">
                    <span class="motto-below-words">
                        <span class="word">Unlocking</span>
                        <span class="word">&nbsp;the</span>
                        <span class="word">&nbsp;code</span>
                        <span class="word">&nbsp;of</span>
                        <span class="word">&nbsp;life,</span>
                        <span class="word">&nbsp;one</span>
                        <span class="word">&nbsp;molecule</span>
                        <span class="word">&nbsp;at</span>
                        <span class="word">&nbsp;a</span>
                        <span class="word">&nbsp;time.</span>
                    </span>
                    <span class="motto-underline"></span>
                </span>
            </div>
            <a href="#about" class="mt-10 inline-block z-10">
                <div class="w-8 h-14 border-2 border-gray-400 rounded-full p-1">
                    <div class="w-1 h-3 bg-gray-400 rounded-full animate-bounce mx-auto mt-1"></div>
                </div>
            </a>
        </section>

        <!-- ABOUT SECTION -->
        <section id="about" class="py-20 lg:py-32">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-white section-title">Pioneering Bioinformatics</h2>
                <div class="max-w-3xl mx-auto mt-10 text-gray-300 text-lg leading-relaxed">
                    <p>
                        MolOmix stands at the forefront of computational biology, offering unparalleled expertise and cutting-edge solutions in molecular modeling and genomic analysis.
                        Our mission is to accelerate scientific discovery by transforming complex biological data into actionable insights.
                        We partner with researchers, pharmaceutical companies, and academic institutions to tackle the most challenging questions in life sciences.
                    </p>
                </div>
            </div>
        </section>

        <!-- SERVICES SECTION -->
        <section id="services" class="py-20 lg:py-32 bg-indigo-900 bg-opacity-20">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-white section-title">Our Services</h2>
                <p class="max-w-2xl mx-auto mt-6 text-gray-400">
                    From atomic-level simulations to large-scale genomic data analysis, we provide a comprehensive suite of computational services.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12">

                    <!-- Molecular Docking -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300">
                        <svg class="service-icon-anim" viewBox="0 0 90 90" fill="none">
                            <ellipse cx="64" cy="73" rx="16" ry="6.2" fill="#00f5ff" opacity="0.15"/>
                            <ellipse cx="23" cy="73" rx="13" ry="5" fill="#ffb900" opacity="0.15"/>
                            <g>
                                <rect x="17" y="46" width="12" height="18" rx="6" fill="#00f5ff" opacity="0.38"/>
                                <rect x="60" y="48" width="8" height="18" rx="4" fill="#ffb900" opacity="0.38"/>
                                <path d="M23 46V24c0-2 1.5-3.5 3.5-3.5h14a4 4 0 014 4V74" stroke="#00f5ff" stroke-width="3" stroke-linecap="round"/>
                                <ellipse cx="34" cy="20" rx="10" ry="4.5" fill="#00f5ff" opacity="0.2"/>
                                <circle cx="40" cy="38" r="3" fill="#00f5ff"/>
                                <circle cx="27" cy="60" r="2" fill="#ffb900"/>
                                <circle cx="67" cy="58" r="2.2" fill="#ffb900"/>
                                <circle cx="64" cy="67" r="3.2" fill="#00f5ff"/>
                                <ellipse cx="50" cy="54" rx="5" ry="2.3" fill="#ffb900"/>
                            </g>
                        </svg>
                        <h3 class="text-2xl font-bold text-white mt-6">Molecular Docking</h3>
                        <p class="mt-4 text-gray-400">We provide fast and accurate predictions of ligand-protein binding, accelerating your drug discovery pipeline.</p>
                    </div>
                    
                    <!-- Molecular Dynamics -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300">
                        <svg class="service-icon-anim" viewBox="0 0 90 90" fill="none">
                            <rect x="15" y="70" width="60" height="8" rx="4" fill="#00f5ff" opacity="0.08"/>
                            <polyline id="md-graph" points="17,67 27,62 37,69 47,55 57,60 67,48 77,53" fill="none" stroke="#00f5ff" stroke-width="3" stroke-linecap="round">
                                <animate attributeName="points"
                                    values="17,67 27,62 37,69 47,55 57,60 67,48 77,53;
                                            17,67 27,60 37,65 47,60 57,52 67,57 77,51;
                                            17,67 27,62 37,69 47,55 57,60 67,48 77,53" 
                                    dur="2s" repeatCount="indefinite"/>
                            </polyline>
                            <circle cx="47" cy="55" r="7" fill="#fffd00" opacity="0.18"/>
                        </svg>
                        <h3 class="text-2xl font-bold text-white mt-6">Molecular Dynamics</h3>
                        <p class="mt-4 text-gray-400">Leverage our high-performance computing to simulate molecular movements, providing deep insights into protein stability and function.</p>
                    </div>

                    <!-- Genomics Data Analysis -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300">
                        <svg class="service-icon-anim" viewBox="0 0 90 90" fill="none">
                            <rect x="15" y="70" width="60" height="8" rx="4" fill="#00f5ff" opacity="0.08"/>
                            <text id="atgc1" x="18" y="46" font-size="32" font-family="monospace" fill="#00f5ff" opacity="0.8">
                                <animate attributeName="y" values="46;36;46" dur="1.6s" repeatCount="indefinite"/>
                                A
                            </text>
                            <text id="atgc2" x="38" y="56" font-size="32" font-family="monospace" fill="#ffb900" opacity="0.8">
                                <animate attributeName="y" values="56;42;56" dur="1.8s" repeatCount="indefinite"/>
                                T
                            </text>
                            <text id="atgc3" x="58" y="42" font-size="32" font-family="monospace" fill="#00f5ff" opacity="0.8">
                                <animate attributeName="y" values="42;54;42" dur="1.5s" repeatCount="indefinite"/>
                                G
                            </text>
                            <text id="atgc4" x="70" y="60" font-size="32" font-family="monospace" fill="#ffb900" opacity="0.8">
                                <animate attributeName="y" values="60;40;60" dur="2.1s" repeatCount="indefinite"/>
                                C
                            </text>
                        </svg>
                        <h3 class="text-2xl font-bold text-white mt-6">Genomics Data Analysis</h3>
                        <p class="mt-4 text-gray-400">Get rapid, comprehensive analysis of your WGS, WES, and RNA-seq data. We turn raw sequences into clear biological insights, fast.</p>
                    </div>

                    <!-- Research Collaboration: handshake emoji -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300 flex flex-col items-center">
                        <div class="service-icon-anim" style="font-size:3.7rem; line-height:1.2; margin-bottom:8px;">
                            ü§ù
                        </div>
                        <h3 class="text-2xl font-bold text-white mt-3">Research Collaboration</h3>
                        <p class="mt-4 text-gray-400">Accelerate your research by embedding our computational experts into your team. We provide the support needed to achieve high-impact results, faster.</p>
                    </div>

                    <!-- Expert Consultancy: headphones emoji -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300 flex flex-col items-center">
                        <div class="service-icon-anim" style="font-size:3.7rem; line-height:1.2; margin-bottom:8px;">
                            üéß
                        </div>
                        <h3 class="text-2xl font-bold text-white mt-3">Expert Consultancy</h3>
                        <p class="mt-4 text-gray-400">Get immediate, strategic advice from our experts to optimize your experimental design, analysis, and research direction for quicker outcomes.</p>
                    </div>

                    <!-- Data Visualization: bar graph SVG -->
                    <div class="glass-card p-8 rounded-xl transform hover:-translate-y-2 transition-transform duration-300">
                        <svg class="service-icon-anim" viewBox="0 0 90 90" fill="none">
                            <ellipse cx="45" cy="72" rx="32" ry="8" fill="#00f5ff" opacity="0.09"/>
                            <g>
                                <rect x="20" y="48" width="8" height="18" rx="2" fill="#ffb900" opacity="0.45"/>
                                <rect x="35" y="35" width="8" height="31" rx="2" fill="#00f5ff" opacity="0.45">
                                    <animate attributeName="y" values="35;40;35" dur="1.7s" repeatCount="indefinite"/>
                                    <animate attributeName="height" values="31;26;31" dur="1.7s" repeatCount="indefinite"/>
                                </rect>
                                <rect x="50" y="42" width="8" height="24" rx="2" fill="#ffb900" opacity="0.45">
                                    <animate attributeName="y" values="42;32;42" dur="1.3s" repeatCount="indefinite"/>
                                    <animate attributeName="height" values="24;34;24" dur="1.3s" repeatCount="indefinite"/>
                                </rect>
                                <rect x="65" y="52" width="8" height="14" rx="2" fill="#00f5ff" opacity="0.45">
                                    <animate attributeName="y" values="52;57;52" dur="2.1s" repeatCount="indefinite"/>
                                    <animate attributeName="height" values="14;9;14" dur="2.1s" repeatCount="indefinite"/>
                                </rect>
                            </g>
                        </svg>
                        <h3 class="text-2xl font-bold text-white mt-6">Data Visualization</h3>
                        <p class="mt-4 text-gray-400">We quickly transform your complex datasets into intuitive, interactive visualizations, enabling clear communication and faster discovery.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CONTACT SECTION -->
        <section id="contact" class="py-20 lg:py-32 bg-indigo-900 bg-opacity-20">
            <div class="container mx-auto px-6">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-white section-title">Start Your Discovery</h2>
                    <p class="max-w-2xl mx-auto mt-6 text-gray-400">Have a project in mind or need expert advice? Reach out to us to see how we can accelerate your research.</p>
                </div>
                <div class="max-w-2xl mx-auto mt-12">
                    <form id="contact-form" action="https://formspree.io/f/mgvlljyl" method="POST" class="space-y-6">
                        <div>
                            <label for="name" class="sr-only">Name</label>
                            <input type="text" name="name" id="name" placeholder="Your Name" required class="w-full bg-gray-900 bg-opacity-50 border border-gray-700 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 transition">
                        </div>
                        <div>
                            <label for="email" class="sr-only">Email</label>
                            <input type="email" name="email" id="email" placeholder="Your Email" required class="w-full bg-gray-900 bg-opacity-50 border border-gray-700 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 transition">
                        </div>
                        <div>
                            <label for="message" class="sr-only">Message</label>
                            <textarea name="message" id="message" rows="5" placeholder="Your Message" required class="w-full bg-gray-900 bg-opacity-50 border border-gray-700 rounded-lg py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 transition"></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="bg-cyan-400 text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-cyan-300 transition-all duration-300 btn-glow text-lg">Send Inquiry</button>
                        </div>
                    </form>
                    <p id="form-status" class="text-center mt-4 h-6"></p>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="py-8 bg-black bg-opacity-30">
        <div class="container mx-auto px-6 text-center text-gray-500">
            <p>&copy; 2025 MolOmix. All Rights Reserved.</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="hover:text-cyan-400">LinkedIn</a>
                <a href="#" class="hover:text-cyan-400">Twitter</a>
                <a href="https://github.com/MolOmixSolutions" class="hover:text-cyan-400">GitHub</a>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
    // Space background
    function drawSpaceBackground() {
        const canvas = document.getElementById('space-bg');
        const ctx = canvas.getContext('2d');
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();
        for (let i = 0; i < 200; i++) {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            const r = Math.random() * 1.2 + 0.3;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, 2 * Math.PI);
            ctx.fillStyle = 'rgba(255,255,255,' + (Math.random() * 0.7 + 0.3) + ')';
            ctx.fill();
        }
        // Planets
        const planets = [
            { x: 0.15, y: 0.2, r: 45, color: '#4537ad' },
            { x: 0.7, y: 0.07, r: 30, color: '#00f5ff' },
            { x: 0.85, y: 0.75, r: 60, color: '#5762d5' },
        ];
        planets.forEach(p => {
            ctx.beginPath();
            ctx.arc(canvas.width * p.x, canvas.height * p.y, p.r, 0, 2 * Math.PI);
            const grad = ctx.createRadialGradient(
                canvas.width * p.x, canvas.height * p.y, 1,
                canvas.width * p.x, canvas.height * p.y, p.r
            );
            grad.addColorStop(0, '#fff');
            grad.addColorStop(0.5, p.color);
            grad.addColorStop(1, '#22284d');
            ctx.fillStyle = grad;
            ctx.globalAlpha = 0.75;
            ctx.fill();
            ctx.globalAlpha = 1;
        });
    }
    drawSpaceBackground();

    // 3D Protein Cartoon Viewer with Ligand (Three.js)
    document.addEventListener('DOMContentLoaded', function() {
        // Responsive canvas sizing
        function resizeProteinCanvas() {
            const container = document.getElementById('protein-canvas-box');
            const canvas = document.getElementById('protein-canvas');
            const width = container.clientWidth;
            const height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
            if(window.threeRenderer) {
                window.threeRenderer.setSize(width, height, false);
                window.threeCamera.aspect = width/height;
                window.threeCamera.updateProjectionMatrix();
            }
        }
        window.addEventListener('resize', resizeProteinCanvas);

        // Three.js setup
        const box = document.getElementById('protein-canvas-box');
        const canvas = document.getElementById('protein-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true, preserveDrawingBuffer: false });
        renderer.setClearColor(0x000000, 0);
        renderer.setPixelRatio(window.devicePixelRatio);

        function updateRendererViewport() {
            const rect = box.getBoundingClientRect();
            renderer.setSize(rect.width, rect.height, false);
        }
        updateRendererViewport();

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, box.clientWidth/box.clientHeight, 0.1, 1000);
        camera.position.set(0, 0, 35);

        // Lighting
        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const d1 = new THREE.DirectionalLight(0x99e9ff, 0.8);
        d1.position.set(16, 14, 22);
        scene.add(d1);
        const d2 = new THREE.DirectionalLight(0xffccff, 0.7);
        d2.position.set(-12, -16, -20);
        scene.add(d2);

        // Load 6LUD from RCSB and render cartoon (tube through CA), ligand as ball and stick
        fetch('https://files.rcsb.org/download/6LUD.pdb')
        .then(res => res.text())
        .then(pdbText => {
            const backbone = [];
            const allResidues = [];
            const ligandAtoms = [];
            const atomsForBonds = [];
            const lines = pdbText.split('\n');
            let colorIdx = 0;
            const cartoonColors = [
                0x12e3ff, 0xaaff00, 0xfffd00, 0xffb900, 0xff4c00, 0x00bfff, 0xbd00ff, 0xff006a
            ];
            for(const line of lines) {
                if(line.startsWith('ATOM')) {
                    const atomName = line.substr(12,4).trim();
                    const resn = line.substr(17,3).trim();
                    const chain = line.substr(21,1);
                    const resi = parseInt(line.substr(22,4));
                    const x = parseFloat(line.substr(30,8));
                    const y = parseFloat(line.substr(38,8));
                    const z = parseFloat(line.substr(46,8));
                    if(atomName === 'CA') {
                        backbone.push(new THREE.Vector3(x, y, z));
                        allResidues.push({resi,resn,chain});
                    }
                } else if(line.startsWith('HETATM')) {
                    const resn = line.substr(17,3).trim();
                    if(resn !== 'HOH' && resn !== 'WAT') {
                        const atomName = line.substr(12,4).trim();
                        const x = parseFloat(line.substr(30,8));
                        const y = parseFloat(line.substr(38,8));
                        const z = parseFloat(line.substr(46,8));
                        const elem = line.substr(76,2).trim() || atomName[0];
                        const serial = parseInt(line.substr(6,5));
                        ligandAtoms.push({pos:new THREE.Vector3(x,y,z), elem, serial, resn, atomName});
                        atomsForBonds.push({serial, pos:new THREE.Vector3(x,y,z)});
                    }
                }
            }
            // Center the group for correct 360 rotation
            let group = new THREE.Group();
            if(backbone.length >= 4) {
                const spline = new THREE.CatmullRomCurve3(backbone, false, 'catmullrom', 0.6);
                const tubeGeom = new THREE.TubeGeometry(spline, backbone.length*6, 0.65, 16, false);
                const colorArr = [];
                for(let i=0; i<tubeGeom.attributes.position.count; i++) {
                    const idx = Math.floor(i * cartoonColors.length / tubeGeom.attributes.position.count);
                    const c = new THREE.Color(cartoonColors[idx]);
                    colorArr.push(c.r, c.g, c.b);
                }
                tubeGeom.setAttribute('color', new THREE.Float32BufferAttribute(colorArr, 3));
                const material = new THREE.MeshPhongMaterial({ vertexColors: true, shininess: 60, specular: 0x222222 });
                const tube = new THREE.Mesh(tubeGeom, material);
                group.add(tube);
                const caSphereGeo = new THREE.SphereGeometry(0.24, 14, 14);
                for(let i=0; i<backbone.length; i+=8) {
                    const sphereMat = new THREE.MeshPhongMaterial({color: cartoonColors[i % cartoonColors.length], shininess: 60});
                    const mesh = new THREE.Mesh(caSphereGeo, sphereMat);
                    mesh.position.copy(backbone[i]);
                    group.add(mesh);
                }
            }
            const elemColors = {
                H:0xffffff, C:0xcccccc, N:0x3050f8, O:0xff0d0d, S:0xffff30, P:0xff8000, F:0x50f850, CL:0x1ff01f, BR:0xa62929, I:0x940094,
                FE:0xe06633, MG:0x8aff8a, ZN:0x7d80b0, SE:0xffa100
            };
            const atomGeo = new THREE.SphereGeometry(0.38, 18, 18);
            for(const atom of ligandAtoms) {
                const color = elemColors[atom.elem.toUpperCase()] || 0xffaaff;
                const mat = new THREE.MeshPhongMaterial({color, shininess: 65});
                const mesh = new THREE.Mesh(atomGeo, mat);
                mesh.position.copy(atom.pos);
                group.add(mesh);
            }
            let conectFound = false;
            for(const line of lines) {
                if(line.startsWith('CONECT')) {
                    conectFound = true;
                    const src = parseInt(line.substr(6,5));
                    for(let i=0;i<4;i++) {
                        const tgt = parseInt(line.substr(11+i*5,5));
                        if(!tgt) continue;
                        const srcAtom = atomsForBonds.find(a => a.serial === src);
                        const tgtAtom = atomsForBonds.find(a => a.serial === tgt);
                        if(srcAtom && tgtAtom && srcAtom.serial < tgtAtom.serial) {
                            addBond(srcAtom.pos, tgtAtom.pos, group);
                        }
                    }
                }
            }
            if(!conectFound) {
                for(let i=0;i<ligandAtoms.length;i++) for(let j=i+1;j<ligandAtoms.length;j++) {
                    const d = ligandAtoms[i].pos.distanceTo(ligandAtoms[j].pos);
                    if(d > 0.9 && d < 1.9) addBond(ligandAtoms[i].pos, ligandAtoms[j].pos, group);
                }
            }
            // Center group at bounding box center (for fixed axis rotation)
            let bbox = new THREE.Box3().setFromObject(group);
            let center = new THREE.Vector3();
            bbox.getCenter(center);
            group.position.sub(center);
            scene.add(group);

            // Store for rotation
            window.proteinGroup = group;
        });

        function addBond(p1, p2, group) {
            const bondGeom = new THREE.CylinderGeometry(0.13, 0.13, p1.distanceTo(p2), 10);
            const mat = new THREE.MeshPhongMaterial({color:0xeeeeee, shininess: 30});
            const bond = new THREE.Mesh(bondGeom, mat);
            bond.position.copy(p1).lerp(p2, 0.5);
            bond.lookAt(p2);
            bond.rotateX(Math.PI/2);
            group.add(bond);
        }

        // Only allow rotation around Y axis and zoom within limits
        let isDragging = false;
        let previousMousePosition = 0;
        let targetYRotation = 0, currentYRotation = 0;

        function onMouseDown(event) {
            if(event.target !== canvas) return;
            isDragging = true;
            previousMousePosition = event.clientX;
        }
        function onMouseUp() { isDragging = false; }
        function onMouseMove(event) {
            if (!isDragging) return;
            const deltaX = event.clientX - previousMousePosition;
            targetYRotation += deltaX * 0.012;
            previousMousePosition = event.clientX;
        }
        box.addEventListener('mousedown', onMouseDown);
        window.addEventListener('mouseup', onMouseUp);
        window.addEventListener('mousemove', onMouseMove);

        // Zoom with wheel (confined to box)
        box.addEventListener('wheel', (event) => {
            camera.position.z += event.deltaY * 0.09;
            camera.position.z = Math.max(17, Math.min(50, camera.position.z));
        }, { passive: true });

        function animate() {
            requestAnimationFrame(animate);
            if(window.proteinGroup) {
                currentYRotation += (targetYRotation - currentYRotation) * 0.15;
                window.proteinGroup.rotation.y = currentYRotation;
            }
            renderer.render(scene, camera);
        }
        animate();

        window.threeRenderer = renderer;
        window.threeCamera = camera;
        resizeProteinCanvas();
        window.addEventListener('resize', function() {
            updateRendererViewport();
            resizeProteinCanvas();
        });
    });

    // Contact form AJAX
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('contact-form');
        if(!form) return;
        form.addEventListener("submit", async function(event) {
            event.preventDefault();
            const status = document.getElementById('form-status');
            const data = new FormData(event.target);
            fetch(event.target.action, {
                method: form.method,
                body: data,
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) {
                    status.innerHTML = "Thanks for your submission!";
                    status.className = 'text-center mt-4 h-6 text-green-400';
                    form.reset();
                } else {
                    response.json().then(data => {
                        if (Object.hasOwn(data, 'errors')) {
                            status.innerHTML = data["errors"].map(error => error["message"]).join(", ");
                        } else {
                            status.innerHTML = "Oops! There was a problem submitting your form";
                            status.className = 'text-center mt-4 h-6 text-red-400';
                        }
                    })
                }
            }).catch(error => {
                status.innerHTML = "Oops! There was a problem submitting your form";
                status.className = 'text-center mt-4 h-6 text-red-400';
            });
        });
    });
    </script>
</body>
</html>
